# ğŸ“š æ‰¹é‡ä¸‹è½½è¯•å·PDFå·¥å…·

ä¸€ä¸ªç”¨äºæ‰¹é‡ä¸‹è½½ä¸œæ–¹åœ¨çº¿æ•™è‚²å¹³å°è¯•å·PDFçš„Node.jså·¥å…·ï¼Œæ”¯æŒå‘½ä»¤è¡Œå’Œç¼–ç¨‹æ¥å£ä¸¤ç§ä½¿ç”¨æ–¹å¼ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- ğŸš€ **æ‰¹é‡ä¸‹è½½**: æ”¯æŒæ‰¹é‡ä¸‹è½½å¤šä¸ªè¯•å·PDFæ–‡ä»¶
- ğŸ“ **åŒç‰ˆæœ¬ç”Ÿæˆ**: è‡ªåŠ¨ç”ŸæˆåŸç‰ˆå’Œå¸¦ç­”æ¡ˆç‰ˆæœ¬
- ğŸ¯ **çµæ´»é…ç½®**: æ”¯æŒè‡ªå®šä¹‰å¹´çº§ã€å­¦æœŸã€ç§‘ç›®ç­‰å‚æ•°
- ğŸ’» **å¤šç§ä½¿ç”¨æ–¹å¼**: æ”¯æŒå‘½ä»¤è¡Œå·¥å…·å’Œç¼–ç¨‹æ¥å£
- ğŸ“Š **è¯¦ç»†æ—¥å¿—**: æä¾›å®Œæ•´çš„æ‰§è¡Œæ—¥å¿—å’Œç»Ÿè®¡ä¿¡æ¯
- ğŸ”§ **æ˜“äºé›†æˆ**: å¯ä½œä¸ºnpmåŒ…é›†æˆåˆ°å…¶ä»–é¡¹ç›®ä¸­

## ğŸ“¦ å®‰è£…

### å…¨å±€å®‰è£…ï¼ˆæ¨èï¼‰

```bash
npm install -g down-paper
```

### æœ¬åœ°å®‰è£…

```bash
npm install down-paper
```

### ä»æºç å®‰è£…

```bash
git clone https://github.com/yourusername/down-paper.git
cd down-paper
npm install
npm link  # é“¾æ¥åˆ°å…¨å±€ï¼Œæ”¯æŒå‘½ä»¤è¡Œä½¿ç”¨
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### âš ï¸ é‡è¦æé†’

**å»ºè®®ä½¿ç”¨ `--output-dir` å‚æ•°æŒ‡å®šè¾“å‡ºç›®å½•**ï¼Œå› ä¸ºï¼š
- é»˜è®¤ä¼šåœ¨å½“å‰ç›®å½•åˆ›å»º `1-download` æ–‡ä»¶å¤¹
- ä½¿ç”¨ `--output-dir` å¯ä»¥æŒ‡å®šè‡ªå®šä¹‰è¾“å‡ºä½ç½®
- é¿å…ä¸ç°æœ‰æ–‡ä»¶å†²çªï¼Œä¾¿äºç®¡ç†ä¸‹è½½çš„PDFæ–‡ä»¶

**æœåŠ¡å™¨ç¯å¢ƒå»ºè®®ä½¿ç”¨ `--headless` å‚æ•°**ï¼š
- æ— å¤´æ¨¡å¼ä¸éœ€è¦å›¾å½¢ç•Œé¢ï¼Œé€‚åˆæœåŠ¡å™¨ç¯å¢ƒ
- å‡å°‘èµ„æºæ¶ˆè€—ï¼Œæé«˜è¿è¡Œæ•ˆç‡
- é¿å…æµè§ˆå™¨å¯åŠ¨å¤±è´¥çš„é—®é¢˜

### 1. å‘½ä»¤è¡Œä½¿ç”¨

#### åŸºæœ¬ç”¨æ³•

```bash
# æ–¹å¼1ï¼šä½¿ç”¨é»˜è®¤è¾“å‡ºç›®å½•ï¼ˆåœ¨å½“å‰ç›®å½•åˆ›å»º 1-download æ–‡ä»¶å¤¹ï¼‰
down-paper --cookie "your-cookie-string"

# æ–¹å¼2ï¼šæŒ‡å®šè‡ªå®šä¹‰è¾“å‡ºç›®å½•ï¼ˆæ¨èï¼‰
# Linux/macOS:
down-paper --cookie "your-cookie-string" --output-dir "./my-papers"

# Windows:
down-paper --cookie "your-cookie-string" --output-dir ".\\my-papers"
```

#### å®Œæ•´å‚æ•°

```bash
# Linux/macOS - æŒ‡å®šæ‰€æœ‰å‚æ•°å’Œè‡ªå®šä¹‰è¾“å‡ºç›®å½•
down-paper \
  --cookie "your-cookie-string" \
  --subject-id 1574 \
  --grade "0557" \
  --quarter 3 \
  --use-scene "khlx" \
  --output-dir "./downloads"

# Windows - æŒ‡å®šæ‰€æœ‰å‚æ•°å’Œè‡ªå®šä¹‰è¾“å‡ºç›®å½•
down-paper ^
  --cookie "your-cookie-string" ^
  --subject-id 1574 ^
  --grade "0557" ^
  --quarter 3 ^
  --use-scene "khlx" ^
  --output-dir ".\\downloads"
```

#### å‚æ•°è¯´æ˜

| å‚æ•° | ç®€å†™ | å¿…éœ€ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|------|--------|------|
| `--cookie` | `-c` | âœ… | - | Cookieå­—ç¬¦ä¸² |
| `--subject-id` | `-s` | âŒ | 1574 | ç§‘ç›®ID |
| `--grade` | `-g` | âŒ | 0557 | å¹´çº§ä»£ç  |
| `--quarter` | `-q` | âŒ | 3 | å­¦æœŸ |
| `--use-scene` | `-u` | âŒ | khlx | ä½¿ç”¨åœºæ™¯ |
| `--output-dir` | `-o` | âŒ | ./1-download | è¾“å‡ºç›®å½• |
| `--headless` | - | âŒ | false | ä½¿ç”¨æ— å¤´æ¨¡å¼è¿è¡Œæµè§ˆå™¨ï¼ˆé€‚åˆæœåŠ¡å™¨ç¯å¢ƒï¼‰ |
| `--help` | `-h` | âŒ | - | æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ |
| `--version` | `-v` | âŒ | - | æ˜¾ç¤ºç‰ˆæœ¬å· |

#### å¹´çº§ä»£ç å¯¹ç…§è¡¨

| ä»£ç  | å¹´çº§ |
|------|------|
| 0555 | S3 |
| 0556 | S4 |
| 0557 | ä¸€å¹´çº§ |
| 0558 | äºŒå¹´çº§ |
| 0559 | ä¸‰å¹´çº§ |
| 0560 | å››å¹´çº§ |
| 0561 | äº”å¹´çº§ |
| 0562 | å…­å¹´çº§ |
| 0567 | ä¸åŒºåˆ† |
| 0999 | å°å‡åˆ |

#### ä½¿ç”¨åœºæ™¯å¯¹ç…§è¡¨

| ä»£ç  | åœºæ™¯ |
|------|------|
| gdk | åŠŸåº•è€ƒ |
| jdcp | é˜¶æ®µæµ‹è¯• |
| khlx | è¯¾åæµ‹è¯• |
| nlcp | èƒ½åŠ›æµ‹è¯„ |
| syttl | ç´ å…»å¤©å¤©ç»ƒ |

#### å­¦æœŸå¯¹ç…§è¡¨

| ä»£ç  | å­¦æœŸ |
|------|------|
| 1 | æ˜¥å­£ |
| 2 | æš‘å‡ |
| 3 | ç§‹å­£ |
| 4 | å¯’å‡ |
| 9 | ä¸åŒºåˆ† |

#### å­¦å¹´å¯¹ç…§è¡¨

| ä»£ç  | å­¦å¹´ |
|------|------|
| 929 | ä¸Šå­¦æœŸ |
| 930 | ä¸‹å­¦æœŸ |
| 931 | å…¨å­¦å¹´ |

#### å¹´ä»½å¯¹ç…§è¡¨

| ä»£ç  | å¹´ä»½ |
|------|------|
| 2023 | 2023å¹´ |
| 2024 | 2024å¹´ |
| 2025 | 2025å¹´ |
| 2026 | 2026å¹´ |

#### ä½¿ç”¨ç±»å‹å¯¹ç…§è¡¨

| ä»£ç  | ç±»å‹ |
|------|------|
| 1 | çº¿ä¸Š |
| 2 | çº¿ä¸‹ |

### 2. ç¼–ç¨‹æ¥å£ä½¿ç”¨

#### åŸºæœ¬ç”¨æ³•

```javascript
const downPaper = require('down-paper');

async function downloadPapers() {
  try {
    const result = await downPaper.generateBatchPDFs({
      cookie: 'your-cookie-string',
      queryParams: {
        subjectId: 1574,
        grade: '0557',
        quarter: 3
      },
      outputDir: './downloads'  // æŒ‡å®šè¾“å‡ºç›®å½•ï¼Œé¿å…æ–‡ä»¶å†²çª
    });
    
    console.log('ä¸‹è½½å®Œæˆ:', result);
  } catch (error) {
    console.error('ä¸‹è½½å¤±è´¥:', error.message);
  }
}

downloadPapers();
```

#### API å‚è€ƒ

##### `generateBatchPDFs(options)`

æ‰¹é‡ç”ŸæˆPDFæ–‡ä»¶çš„ä¸»è¦æ–¹æ³•ã€‚

**å‚æ•°:**

- `options.cookie` (string, å¿…éœ€): Cookieå­—ç¬¦ä¸²
- `options.queryParams` (object): æŸ¥è¯¢å‚æ•°
  - `subjectId` (number): ç§‘ç›®IDï¼Œé»˜è®¤ 1574
  - `useScene` (string): ä½¿ç”¨åœºæ™¯ï¼Œé»˜è®¤ 'khlx'
  - `grade` (string): å¹´çº§ï¼Œé»˜è®¤ '0557'
  - `quarter` (number): å­¦æœŸï¼Œé»˜è®¤ 3
- `options.outputDir` (string): è¾“å‡ºç›®å½•ï¼Œé»˜è®¤ './1-download'

**è¿”å›å€¼:**

```javascript
{
  total: 10,        // æ€»ä»»åŠ¡æ•°
  success: 8,       // æˆåŠŸä»»åŠ¡æ•°
  failed: 2,        // å¤±è´¥ä»»åŠ¡æ•°
  duration: 120000, // æ€»è€—æ—¶ï¼ˆæ¯«ç§’ï¼‰
  failedLinks: [    // å¤±è´¥çš„é“¾æ¥è¯¦æƒ…
    {
      index: 1,
      url: 'https://example.com/paper1',
      error: 'Error message'
    }
  ]
}
```

##### `getPapers(params, cookies)`

è·å–è¯•å·åˆ—è¡¨ã€‚

```javascript
const papers = await downPaper.getPapers({
  subjectId: 1574,
  grade: '0557'
}, 'your-cookie-string');
```

##### `createLinks(papersData)`

ä»è¯•å·æ•°æ®ç”Ÿæˆé“¾æ¥æ•°ç»„ã€‚

```javascript
const links = downPaper.createLinks(papersData);
```

##### `processSinglePDF(options)`

å¤„ç†å•ä¸ªiframeå¹¶ç”ŸæˆPDFã€‚

```javascript
const result = await downPaper.processSinglePDF({
  url: 'https://example.com/paper',
  cookies: 'your-cookie-string',
  outputDir: './downloads'
});
```

##### `generateSinglePDF(options)`

ç”Ÿæˆå•ä¸ªPDFæ–‡ä»¶ã€‚

```javascript
const result = await downPaper.generateSinglePDF({
  url: 'https://example.com/paper',
  cookies: cookieArray,
  outputDir: './downloads'
});
```

##### `getLogger()`

è·å–æ—¥å¿—è®°å½•å™¨å®ä¾‹ã€‚

```javascript
const logger = downPaper.getLogger();
logger.info('å¼€å§‹å¤„ç†');
```

## ğŸ”§ é…ç½®è¯´æ˜

### Cookie è·å–æ–¹æ³•

1. ç™»å½•ä¸œæ–¹åœ¨çº¿æ•™è‚²å¹³å°
2. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· (F12)
3. åˆ‡æ¢åˆ° Network æ ‡ç­¾é¡µ
4. åˆ·æ–°é¡µé¢æˆ–è¿›è¡Œä»»ä½•æ“ä½œ
5. åœ¨è¯·æ±‚å¤´ä¸­æ‰¾åˆ° `Cookie` å­—æ®µ
6. å¤åˆ¶å®Œæ•´çš„ Cookie å­—ç¬¦ä¸²

### è¾“å‡ºæ–‡ä»¶ç»“æ„

```
downloads/
â”œâ”€â”€ 1å¹´çº§/
â”‚   â”œâ”€â”€ æ€ç»´B-1å¹´çº§-ç¬¬1è®².pdf
â”‚   â”œâ”€â”€ æ€ç»´B-1å¹´çº§-ç¬¬1è®²-ç­”æ¡ˆ.pdf
â”‚   â”œâ”€â”€ æ€ç»´B-1å¹´çº§-ç¬¬2è®².pdf
â”‚   â””â”€â”€ æ€ç»´B-1å¹´çº§-ç¬¬2è®²-ç­”æ¡ˆ.pdf
â”œâ”€â”€ 2å¹´çº§/
â”‚   â”œâ”€â”€ äººæ•™ç‰ˆ-2å¹´çº§-ç¬¬4è®².pdf
â”‚   â””â”€â”€ äººæ•™ç‰ˆ-2å¹´çº§-ç¬¬4è®²-ç­”æ¡ˆ.pdf
â””â”€â”€ ...
```

## ğŸ“ æ—¥å¿—ç³»ç»Ÿ

å·¥å…·æä¾›å®Œæ•´çš„æ—¥å¿—è®°å½•åŠŸèƒ½ï¼š

- **æ§åˆ¶å°è¾“å‡º**: å®æ—¶æ˜¾ç¤ºæ‰§è¡Œè¿›åº¦å’Œç»“æœ
- **æ–‡ä»¶æ—¥å¿—**: è‡ªåŠ¨ä¿å­˜åˆ° `logs/` ç›®å½•
- **æ—¥å¿—çº§åˆ«**: INFO, WARN, ERROR, SUCCESS
- **è¯¦ç»†ç»Ÿè®¡**: åŒ…å«æˆåŠŸç‡ã€è€—æ—¶ç­‰ç»Ÿè®¡ä¿¡æ¯

## ğŸ› ï¸ å¼€å‘

### é¡¹ç›®ç»“æ„

```
down-paper/
â”œâ”€â”€ bin/                    # CLI å…¥å£æ–‡ä»¶
â”‚   â””â”€â”€ down-paper.js
â”œâ”€â”€ lib/                    # å‘å¸ƒåçš„ä»£ç 
â”‚   â”œâ”€â”€ index.js           # API å…¥å£
â”‚   â”œâ”€â”€ batchProcessor.js  # æ‰¹é‡å¤„ç†é€»è¾‘
â”‚   â”œâ”€â”€ iframeProcessor.js # iframe å¤„ç†
â”‚   â”œâ”€â”€ pdfGenerator.js    # PDF ç”Ÿæˆ
â”‚   â”œâ”€â”€ request.js         # HTTP è¯·æ±‚
â”‚   â””â”€â”€ logger.js          # æ—¥å¿—ç³»ç»Ÿ
â”œâ”€â”€ src/                   # æºä»£ç 
â”œâ”€â”€ logs/                  # æ—¥å¿—æ–‡ä»¶
â”œâ”€â”€ 1-download/           # é»˜è®¤ä¸‹è½½ç›®å½•
â”œâ”€â”€ package.json
â””â”€â”€ README.md
```

### æ„å»º

```bash
npm run build
```

### æµ‹è¯•

```bash
# æµ‹è¯• CLI å·¥å…·
down-paper --help

# æµ‹è¯• API
node -e "console.log(require('./lib/index.js').version)"
```

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## ğŸ“ æ”¯æŒ

å¦‚æœæ‚¨åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š

1. æŸ¥çœ‹ [Issues](https://github.com/yourusername/down-paper/issues)
2. æäº¤æ–°çš„ Issue
3. è”ç³»ç»´æŠ¤è€…

## ğŸ”„ æ›´æ–°æ—¥å¿—

### v2.3.3

- ğŸ–¥ï¸ **è·¨å¹³å°æµè§ˆå™¨**: ä¿®å¤äº† Windows ä¸‹ Chrome æµè§ˆå™¨å¯åŠ¨å¤±è´¥çš„é—®é¢˜
- ğŸ”§ **ä¼˜åŒ–**: åˆ›å»ºäº†ç»Ÿä¸€çš„è·¨å¹³å°æµè§ˆå™¨é…ç½®å·¥å…· `browserConfig.js`
- ğŸ“¦ **å®Œå–„**: æ”¯æŒ Windowsã€macOSã€Linux çš„ Chrome è‡ªåŠ¨æ£€æµ‹
- ğŸ¯ **æ”¹è¿›**: ä¼˜åŒ–äº†æµè§ˆå™¨å¯åŠ¨å‚æ•°å’Œé”™è¯¯å¤„ç†

### v2.3.2

- ğŸ–¥ï¸ **è·¨å¹³å°æµè§ˆå™¨**: ä¿®å¤äº† Windows ä¸‹æµè§ˆå™¨å¯åŠ¨å¤±è´¥çš„é—®é¢˜
- ğŸ”§ **æ™ºèƒ½è·¯å¾„æ£€æµ‹**: è‡ªåŠ¨æ£€æµ‹ Windowsã€macOSã€Linux çš„ Chrome å®‰è£…è·¯å¾„
- ğŸ¯ **æ— å¤´æ¨¡å¼**: æ–°å¢ `--headless` å‚æ•°ï¼Œé€‚åˆæœåŠ¡å™¨ç¯å¢ƒè¿è¡Œ
- ğŸ“ **é”™è¯¯å¤„ç†**: æ”¹è¿›äº†æµè§ˆå™¨å¯åŠ¨å¤±è´¥æ—¶çš„é”™è¯¯æç¤ºå’Œè§£å†³æ–¹æ¡ˆ
- ğŸš€ **æ€§èƒ½ä¼˜åŒ–**: æ·»åŠ äº†æ›´å¤šæµè§ˆå™¨å¯åŠ¨å‚æ•°ï¼Œæé«˜ç¨³å®šæ€§

### v2.3.1

- ğŸ”§ **ä¿®å¤**: ä¿®å¤äº† Windows ä¸‹ "cannot find module ../src/batchProcessor" é”™è¯¯
- ğŸ“¦ **æ„å»º**: ä¼˜åŒ–äº†æ„å»ºè„šæœ¬ï¼Œç¡®ä¿å‘å¸ƒåŒ…ä¸­çš„æ¨¡å—è·¯å¾„æ­£ç¡®
- ğŸ¯ **å®Œå–„**: ä¿®å¤äº† CLI å·¥å…·å’Œ API å…¥å£çš„æ¨¡å—å¼•ç”¨é—®é¢˜

### v2.3.0

- ğŸ–¥ï¸ **è·¨å¹³å°**: æ·»åŠ äº† Windows è·¯å¾„å…¼å®¹æ€§æ”¯æŒ
- ğŸ”§ **ä¿®å¤**: ä½¿ç”¨ `path.join()` å’Œ `path.sep` ç¡®ä¿è·¨å¹³å°è·¯å¾„å¤„ç†
- ğŸ“ **å®Œå–„**: æ›´æ–°äº† Windows å’Œ Linux/macOS çš„ä½¿ç”¨ç¤ºä¾‹
- ğŸ¯ **ä¼˜åŒ–**: æ”¹è¿›äº†è·¯å¾„æ ‡å‡†åŒ–é€»è¾‘ï¼Œé¿å…åŒåˆ†éš”ç¬¦é—®é¢˜

### v2.2.0

- ğŸ¯ **ä¼˜åŒ–**: æ›´æ–°äº†ä½¿ç”¨å»ºè®®ï¼Œæ¨èä½¿ç”¨ `--output-dir` å‚æ•°
- ğŸ“ **æ”¹è¿›**: ä¸å†å¼ºåˆ¶è¦æ±‚åœ¨ç©ºæ–‡ä»¶å¤¹ä¸‹è¿è¡Œ
- ğŸ’¡ **å®Œå–„**: æ›´æ–°äº†æ‰€æœ‰ç¤ºä¾‹å’Œå¸®åŠ©ä¿¡æ¯
- ğŸš€ **æå‡**: æ›´çµæ´»çš„ä½¿ç”¨æ–¹å¼ï¼Œç”¨æˆ·å¯ä»¥åœ¨ä»»ä½•ç›®å½•ä¸‹è¿è¡Œ

### v2.1.0

- ğŸ”§ **ä¿®å¤**: ä¿®å¤äº† `--output-dir` å‚æ•°ä¸ç”Ÿæ•ˆçš„é—®é¢˜
- ğŸ“ **æ–°å¢**: è‡ªåŠ¨åˆ›å»ºè¾“å‡ºç›®å½•åŠŸèƒ½
- âš ï¸ **æ”¹è¿›**: æ·»åŠ äº†åœ¨ç©ºæ–‡ä»¶å¤¹ä¸‹è¿è¡Œçš„é‡è¦æé†’
- ğŸ“š **å®Œå–„**: æ›´æ–°äº†å®Œæ•´çš„å­—æ®µå­—å…¸å’Œå¯¹ç…§è¡¨
- ğŸ¯ **ä¼˜åŒ–**: æ”¹è¿›äº†è·¯å¾„å¤„ç†å’Œç›®å½•åˆ›å»ºé€»è¾‘

### v2.0.0

- ğŸ“š **æ–°å¢**: å®Œæ•´çš„å­—æ®µå­—å…¸å’Œå¯¹ç…§è¡¨
- âš ï¸ **æ”¹è¿›**: æ·»åŠ äº†è¿è¡Œç¯å¢ƒæé†’
- ğŸ“– **å®Œå–„**: æ›´æ–°äº†å¸®åŠ©ä¿¡æ¯å’Œç¤ºä¾‹

### v1.0.0

- âœ¨ åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- ğŸš€ æ”¯æŒæ‰¹é‡ä¸‹è½½è¯•å·PDF
- ğŸ’» æä¾›å‘½ä»¤è¡Œå’Œç¼–ç¨‹æ¥å£
- ğŸ“Š å®Œæ•´çš„æ—¥å¿—ç³»ç»Ÿ
- ğŸ¯ çµæ´»çš„é…ç½®é€‰é¡¹

---

**æ³¨æ„**: è¯·ç¡®ä¿æ‚¨æœ‰æƒé™è®¿é—®ç›¸å…³æ•™è‚²èµ„æºï¼Œå¹¶éµå®ˆç›¸å…³ä½¿ç”¨æ¡æ¬¾ã€‚